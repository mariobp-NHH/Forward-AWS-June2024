{% extends "es_course/es_course_layout.html" %}
{% block content %}

    <!-- Header -->
    <section xmlns="http://www.w3.org/1999/html">
        <header class="header_css">
            <div class="container">
                <div>
                    <h1>Capítulo 4. Bases de Datos y Validación</h1>
                    <p class="mb-1">
                        En el capítulo anterior, introdujimos formularios para ayudar a los usuarios a interactuar con nuestra aplicación. 
                        En ese capítulo, cuando un usuario se registra en nuestra aplicación, su información no se guarda en una base de datos. 
                        Para evitar ese problema, en esta sección aprenderemos a <strong>crear bases de datos</strong> y a realizar <strong>consultas 
                            básicas para acceder a la información almacenada en nuestras bases de datos</strong>.
                        <br>
                        <br>
                        En este capítulo, nos centramos en el inicio de sesión y la autenticación de usuarios. 
                        Estudiamos el <strong>paquete Flask-login</strong> y cómo podemos utilizar sus funcionalidades para permitir que el usuario inicie 
                        sesión, cierre sesión y restrinja el acceso a algunas rutas si el usuario no está autenticado. También cambiamos el diseño de nuestra 
                        aplicación según si el usuario está conectado o desconectado.
                    </p>                    
                    </br>
                    <div class="container_buttons_links_header">
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">YouTube (sección 1a)</a>
                    </div>
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">YouTube (sección 1b)</a>
                    </div>
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">YouTube (sección 1c)</a>
                    </div>
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">YouTube (sección 2a)</a>
                    </div>
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">YouTube (sección 2b)</a>
                    </div>
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">YouTube (sección 3)</a>
                    </div>
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">YouTube (sección 4a)</a>
                    </div>
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">YouTube (sección 4b)</a>
                    </div>
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">YouTube (sección 4c)</a>
                    </div>
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2", style="background-color:#007bff;">GitHub</a>
                    </div>
                    </div>  

                    <div class="list-group", style="padding: 15px 0px;">
                        <a href="#section1" class="list-group-item list-group-item-action flex-column align-items-start active">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">Bases de Datos, Básico</h5>
                            </div>
                            <p class="mb-1">
                                En esta sección, aprendemos cómo crear bases de datos en una aplicación simple. Primero, creamos una base de datos con una tabla. En segundo lugar, creamos una base de datos con dos tablas. En tercer lugar, creamos dos bases de datos, cada una con una tabla, que están conectadas.
                            </p>
                        </a>
                        <a href="#section2" class="list-group-item list-group-item-action flex-column align-items-start">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">Bases de Datos, Aplicadas</h5>
                            </div>
                            <p class="mb-1">
                                En esta sección, aprendemos cómo crear dos bases de datos en nuestra aplicación. Primero, creamos dos bases de datos conectadas entre sí. En segundo lugar, realizamos algunas consultas y mostramos la información de esas consultas en nuestra aplicación.
                            </p>                            
                        </a>
                        <a href="#section3" class="list-group-item list-group-item-action flex-column align-items-start">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">Personalización de Validadores de Formularios WTF</h5>
                            </div>
                            <p class="mb-1">
                                Esta sección nos permite <strong>personalizar los validadores de formularios</strong> para ayudar al usuario a entender la información correcta que debe introducir en nuestra aplicación.
                            </p>                            
                        </a>
                        <a href="#section4" class="list-group-item list-group-item-action flex-column align-items-start">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">Paquete Flask-login</h5>
                            </div>
                            <p class="mb-1">
                                Esta sección estudia el <strong>paquete Flask-login</strong> y sus funcionalidades que nos permiten mejorar el inicio de sesión, cierre de sesión y otros aspectos de nuestra aplicación relacionados con la autenticación de usuarios.
                            </p>                            
                        </a>
                        <a href="#section5" class="list-group-item list-group-item-action flex-column align-items-start">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">Reto semanal</h5>
                            </div>
                            <p class="mb-1">
                                Creamos más datos en nuestra base de datos y aprendemos cómo introducir más consultas para divulgar esa información.
                            </p>                                                       
                        </a>
                    </div>
                </div>
                <img
                src="{{url_for('static', filename='figures/economies_of_spanish_course/chapters/ch4.svg')}}"
                        alt=""/>
            </div>
        </header>
    </section>

    <!-- Section 1 -->
    <section class="section_1" id="section1">
        <div class="container" style="display:block;">
            <h1>Bases de datos, básico</h1>
            <h4>Algunos enlaces útiles</h4>
            <p>
                Los enlaces a los videos de YouTube y la cuenta de GitHub para esta sección están a continuación:
            </p>
            <div class="section_container_buttons_chapters">
                <a class="btn-section1" href="#" target="_blank">YouTube (Sección 1a)</a>
                <a class="btn-section1" href="#" target="_blank">YouTube (Sección 1b)</a>
                <a class="btn-section1" href="#" target="_blank">YouTube (Sección 1c)</a>
                <a class="btn-section1" href="#" target="_blank">GitHub (Boilerplate 1a)</a>
                <a class="btn-section1" href="#" target="_blank">GitHub (Final 1a)</a>
                <a class="btn-section1" href="#" target="_blank">GitHub (Boilerplate 1b)</a>
                <a class="btn-section1" href="#" target="_blank">GitHub (Final 1b)</a>
                <a class="btn-section1" href="#" target="_blank">GitHub (Boilerplate 1c)</a>
                <a class="btn-section1" href="#" target="_blank">GitHub (Final 1c)</a>
            </div>
            <p>
                Vamos a usar la línea de comandos para interactuar con nuestras bases de datos, pero también accedemos a ellas mediante una Interfaz Gráfica de Usuario. Te sugiero que descargues e instales DB Browser para SQLite o cualquier otra Interfaz Gráfica de Usuario para interactuar con nuestra base de datos. Para descargar DB Browser para SQLite, puedes usar los siguientes enlaces:
            </p>
            <div class="section_container_buttons_chapters">
                <a class="btn-section1" href="https://sqlitebrowser.org/dl/"  target="_blank">SQLite (Windows y Mac)</a>
                <a class="btn-section1" href="https://sqlitebrowser.org/blog/macos-installer-rebuilt-for-3-11-1/"  target="_blank">SQLite (Mac)</a>
            </div> 
            <p>
                Toda la información en esta sección se ha tomado de los siguientes enlaces:
            </p>
            <div class="section_container_buttons_chapters">
                <a class="btn-section1" href="https://flask-sqlalchemy.palletsprojects.com/en/3.0.x/"  target="_blank">Flask SQLAlchemy</a>
                <a class="btn-section1" href="https://www.youtube.com/watch?v=cYWiDiIUxQc&list=PL-osiE80TeTs4UjLw5MM6OjgkjFeUxCYH&index=4"  target="_blank">Corey</a>
                <a class="btn-section1" href="https://courses.prettyprinted.com/courses/1016334/lectures/21156835"  target="_blank">PrettyPrinted</a>
            </div> 
            <h4>¿Qué es Flask-SQLAlchemy?</h4>
            <p>
                Flask-SQLAlchemy es una <strong>extensión para Flask</strong> que agrega soporte para SQLAlchemy a tu aplicación. Simplifica el uso de SQLAlchemy con Flask al configurar objetos comunes y patrones para usar esos objetos, como una sesión vinculada a cada solicitud web, modelos y motores. Flask-SQLAlchemy no cambia cómo funciona o se usa SQLAlchemy.
                <br>
                <br>
                <u>¿Qué es SQLAlchemy?</u> <strong>SQLAlchemy es el kit de herramientas SQL para Python</strong> y Mapper Relacional de Objetos que otorga a los desarrolladores de aplicaciones el poder y la flexibilidad completos de SQL.
                <br>
                <br>
                Proporciona un conjunto completo de patrones de persistencia a nivel empresarial bien conocidos, diseñados para un acceso a bases de datos eficiente y de alto rendimiento, adaptados a un lenguaje de dominio simple y Pythonico.
                <br>
                <br>
                <u>¿Qué es SQL?</u> <strong>Structured Query Language</strong>, abreviado como SQL, es un lenguaje específico de dominio utilizado en programación y diseñado para gestionar datos en un sistema de gestión de bases de datos relacional, o para el procesamiento de flujos en un sistema de gestión de flujos de datos relacional.
            </p>  
        </div>  
    
        <div class="container">
            <div class="boxa" style="text-align: left; margin:0px; padding:0px;">
                <h4>Nuestra primera base de datos. Una base de datos con una tabla.</h4>
                <p>
                    Los enlaces al video de YouTube y a la cuenta de GitHub para esta sección están a continuación:
                </p>
                <div class="section_container_buttons_chapters">
                    <a class="btn-section1" href="#" target="_blank">YouTube (Sección 1a)</a>
                    <a class="btn-section1" href="#" target="_blank">GitHub (Boilerplate 1a)</a>
                    <a class="btn-section1" href="#" target="_blank">GitHub (Final 1a)</a>
                </div>
                <p class="text-left">
                    Comenzamos creando una aplicación simple con una base de datos con una tabla. Procedemos en cinco pasos (el código para la aplicación está en el panel derecho):
                    <ol>
                        <li>
                            <strong>Importamos</strong> SQLAlchemy:
                            <pre><code class="html"></code>
    from flask_sqlalchemy import SQLAlchemy
                            </code></pre>                             
                        </li>
                        <li>
                            Asignamos una <strong>ubicación</strong> para la base de datos. En nuestro caso, la base de datos estará en nuestro ordenador local. Más adelante, en la parte de producción de nuestra aplicación, crearemos una base de datos PostgreSQL en AWS:
                            <pre><code class="html"></code>
    application.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///light_talk_app.db'
                            </code></pre> 
                        </li>
                        <li>
                            Definimos nuestra base de datos:
                            <pre><code class="html"></code>
    db = SQLAlchemy(application)
                            </code></pre> 
                        </li>                       
                    </ol>
                </p> 
            </div> 
            <div class="boxa">
                <h5>Una base de datos con una tabla</h5>
    <pre><code class="html">
    from flask import Flask
    from flask_sqlalchemy import SQLAlchemy
    
    application = Flask(__name__) 
    
    application.config['SQLALCHEMY_DATABASE_URI'] = 
    'sqlite:///light_talk_app.db'
    db = SQLAlchemy(application)
    
    class User(db.Model):
        __tablename__ = "user_table"
        id = db.Column(db.Integer, primary_key=True)
        username = db.Column(db.String(30), unique=True, 
        nullable=False)
        
    @application.route('/')
    @application.route('/home')
    def home():
        return "&#60;h1&#62;Bienvenido a casa&#60;/h1&#62;"
    
    if __name__=='__main__':
        application.run(debug=True) 
    </code></pre>                
            </div> 
        </div> 
    
        <div class="container" style="display:block;">
            <p class="text-left">
                <ol start="4">
                    <li>
                        <strong>Crearemos</strong> una tabla para nuestra base de datos.
                        <pre><code class="html">
    class User(db.Model):
    __tablename__ = "user_table"
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(30), unique=True, nullable=False)
                        </code></pre> 
                    </li>
                    <li>
                        <strong>Creamos nuestra base de datos</strong>. Necesitamos proceder en tres pasos.
                    </li>
                    <ol type="a">
                        <li>
                            En el terminal de Visual Studio Code, escribe: python.
                        </li>
                        <br>
                        <li>
                            En el terminal de Python, escribe: from application import db
                        </li>
                        <br>
                        <li>
                            En el terminal de Python, escribe: db.create_all()
                        </li>
                        <br>
                        <li>
                            Cuando termines, escribe: quit()
                        </li>
                    </ol>
                    
                    </li>                
                </ol> 
            </p>
        </div>
        
        <div class="container">
            <div class="box_two">
                <h5>1. Rellenar nuestra base de datos</h5>
                <p>
                    Una vez que hayamos creado nuestra base de datos, podemos comenzar a <strong>rellenarla</strong> con datos. Procedemos en los siguientes pasos:
                    <ol>
                        <li>
                            En el <strong>terminal de Visual Studio</strong>, escribe: python
                        </li>
                        <li>
                            En el <strong>terminal de Python</strong>, escribe una por una las siguientes líneas de código:
                            <pre><code class="html"></code>
        from application import User
        user1 = User(username='Bjørk')
        db.session.add(user1)
        user2 = User(username='Fjell')
        db.session.add(user2)
        db.session.commit()
                            </code></pre> 
                        </li>
                    </ol>
                </p>
            </div> 
            <div class="box_two">
                <h5>2. Consultas básicas</h5>
                <p>
                    También podemos realizar algunas <strong>consultas básicas</strong>. 
                    <ol>
                        <li>
                            En el <strong>terminal de Visual Studio</strong>, escribe: python
                        </li>
                        <li>
                            En el <strong>terminal de Python</strong>, escribe una por una las siguientes líneas de código:
                            <pre><code class="html"></code>
        User.query.first()
        User.query.filter_by(username='Bjørk').all()
        User.query.filter_by(username='Bjørk').first().username
                            </code></pre> 
                        </li>
                    </ol>
                </p>
            </div> 
        </div>
        
        <div class="container">
            <div class="box_two">
                <h5>3. Crear variables</h5>
                <p>
                    Podemos <strong>crear variables</strong> utilizando consultas básicas.
                    <ol>
                        <li>
                            En el <strong>terminal de Visual Studio</strong>, escribe: python
                        </li>
                        <li>
                            En el <strong>terminal de Python</strong>, escribe una por una las siguientes líneas de código:
                            <pre><code class="html"></code>
        user1 = User.query.get(1)
        user1.id  
        user1.username 
        user2 = User.query.filter_by(username='Bjørk').first()
        user2.id        
        user2.username                                               
                            </code></pre> 
                        </li>
                    </ol>
                </p>
            </div> 
            <div class="box_two" style="background-color: #f29545;">
                
            </div> 
        </div> 
        
        <div class="container">
            <div class="boxa" style="text-align: left; margin:0px; padding:0px;">
                <h4>Una base de datos con dos tablas</h4>
                <p>
                    Los enlaces al video de YouTube y a la cuenta de GitHub para esta sección están a continuación:
                </p>
                <div class="section_container_buttons_chapters">
                    <a class="btn-section1" href="#" target="_blank">YouTube (Sección 1b)</a>
                    <a class="btn-section1" href="#" target="_blank">GitHub (Boilerplate 1b)</a>
                    <a class="btn-section1" href="#" target="_blank">GitHub (Final 1b)</a>                
                </div>
                <p class="text-left">
                    Para introducir una segunda tabla en nuestra base de datos, procedemos en dos pasos diferentes (el código para la aplicación está en el panel derecho):
                    <ol>
                        <li>
                            Creamos una <strong>segunda tabla</strong>:
                            <pre><code class="html"></code>
        class Sentence(db.Model):
            __tablename__= 'sentence_table'
            id = db.Column(db.Integer, primary_key=True)
            incorrect_sentence = db.Column(db.String)                             
                            </code></pre>                             
                        </li>
                        <li>
                            Necesitamos <strong>conectar las tablas User y Sentence</strong>. Para hacer esto, necesitamos introducir un cambio en la tabla User y otro en la tabla Sentence.
                            <ol type="a">
                                <li>
                                    En la tabla User:
                                    <pre><code class="html"></code>
        sentence = db.relationship('Sentence', backref='author', lazy=True)
                                    </code></pre> 
                                </li>
                                <li>
                                    En la tabla Sentence:
                                    <pre><code class="html"></code>
        user_id = db.Column(db.Integer, db.ForeignKey('user_table.id'), 
        nullable=False)
                                    </code></pre> 
                                </li>
                            </ol>
                        </li>                     
                    </ol>
                </p> 
            </div> 
            <div class="boxa">
                <h5>Una base de datos con dos tablas</h5>
<pre><code class="html">
from flask import Flask
from flask_sqlalchemy import SQLAlchemy

application = Flask(__name__) 

application.config['SQLALCHEMY_DATABASE_URI'] = 
'sqlite:///light_talk_app.db'
db = SQLAlchemy(application)

class User(db.Model):
    __tablename__ = "user_table"
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(30), 
    unique=True, nullable=False)
    sentence = db.relationship('Sentence', 
    backref='author', lazy=True)

class Sentence(db.Model):
    __tablename__= 'sentence_table'
    id = db.Column(db.Integer, primary_key=True)
    incorrect_sentence = db.Column(db.String) 
    user_id = db.Column(db.Integer, 
    db.ForeignKey('user_table.id'), nullable=False)
    
@application.route('/')
@application.route('/home')
def home():
    return "&#60;h1&#62;Bienvenido a casa&#60;/h1&#62;"

if __name__=='__main__':
    application.run(debug=True) 
</code></pre>                
            </div> 
        </div> 
        
        <div class="container">
            <div class="box_two">
                <h5>1. Rellenar nuestra base de datos</h5>
                <p>
                    Una vez que hayamos creado nuestra base de datos, podemos comenzar a <strong>rellenarla</strong> con datos. Procedemos en los siguientes pasos:
                    <ol>
                        <li>
                            En el <strong>terminal de Visual Studio</strong>, escribe: python
                        </li>
                        <li>
                            En el <strong>terminal de Python</strong>, escribe una por una las siguientes líneas de código:
                            <pre><code class="html"></code>
        from application import User, Sentence
        user1 = User(username='Bjørk')
        db.session.add(user1)
        user2 = User(username='Fjell')
        db.session.add(user2)
        db.session.commit()
        
        sentence1 = Sentence(incorrect_sentence = 
        "Mi perro es bonitos", user_id=user1.id)
        sentence2 = Sentence(incorrect_sentence = 
        "Mi casa es bonito", user_id=user1.id)
        db.session.add(sentence1)
        db.session.add(sentence2)
        sentence3 = Sentence(incorrect_sentence = 
        "Mis perros es grande", user_id=user2.id)
        sentence4 = Sentence(incorrect_sentence = 
        "Mi amiga es alto", user_id=user2.id)
        db.session.add(sentence3)
        db.session.add(sentence4)
        db.session.commit()
                            </code></pre> 
                        </li>
                    </ol>
                </p>
            </div> 
            <div class="box_two">
                <h5>2. Consultas básicas</h5>
                <p>
                    También podemos realizar algunas <strong>consultas básicas</strong>. 
                    <ol>
                        <li>
                            En el <strong>terminal de Visual Studio</strong>, escribe: python
                        </li>
                        <li>
                            En el <strong>terminal de Python</strong>, escribe una por una las siguientes líneas de código:
                            <pre><code class="html"></code>
        sentence1 = Sentence.query.first()
        sentence1.user_id
        sentence1.author
        sentence1.author.username
        sentence1.incorrect_sentence
        db.session.add(sentence4)
        db.session.commit()
                            </code></pre> 
                        </li>
                    </ol>
                </p>
            </div> 
        </div>
        
        <div class="container">
            <div class="boxa" style="text-align: left; margin:0px; padding:0px;">
                <h4>Dos bases de datos, con una tabla cada una</h4>
                <p>
                    Los enlaces al video de YouTube y a la cuenta de GitHub para esta sección están a continuación:
                </p>
                <div class="section_container_buttons_chapters">
                    <a class="btn-section1" href="#" target="_blank">YouTube (Sección 1c)</a>
                    <a class="btn-section1" href="#" target="_blank">GitHub (Boilerplate 1c)</a>
                    <a class="btn-section1" href="3" target="_blank">GitHub (Final 1c)</a>               
                </div>
                <p class="text-left">
                    En muchos casos, estamos interesados en tener diferentes bases de datos en nuestra aplicación. Si nuestra empresa opera en diferentes países, podría ser útil tener bases de datos separadas para cada país. Si nuestra empresa tiene diferentes fábricas, también podría ser útil tener diferentes bases de datos. Aprendemos cómo crear dos bases de datos con una tabla cada una. Es muy fácil crear más bases de datos y/o tablas en cada base de datos.
                    <br>
                    <br>
                    Para crear dos bases de datos con dos tablas, procedemos en tres pasos (el código para la aplicación está en el panel derecho):
                    <ol>
                        <li>
                            Necesitamos <strong>crear enlaces</strong> a cada base de datos adicional.
                            <pre><code class="html"></code>
        application.config['SQLALCHEMY_DATABASE_URI'] = 
        'sqlite:///user.db'
        application.config['SQLALCHEMY_BINDS'] = 
        {'sentence': 'sqlite:///sentence.db'}
                            </code></pre>                             
                        </li>
                        <li>
                            Necesitamos <strong>introducir ese enlace en la(s) tabla(s) asociada(s) con esa base de datos</strong>.
                            <pre><code class="html"></code>
        class Sentence(db.Model):
            __bind_key__ = 'sentence'
            __tablename__ = 'sentence_table'
                            </code></pre>                                 
                        </li>
                        <li>
                            <strong>Creamos nuestra base de datos</strong>. Necesitamos proceder en tres pasos.
                        </li>
                        <ol type="a">
                            <li>
                                En el terminal de Visual Studio Code, escribe: python.
                            </li>
                            <br>
                            <li>
                                En el terminal de Python, escribe: from application import db
                            </li>
                            <br>
                            <li>
                                En el terminal de Python, escribe: db.create_all()
                            </li>
                            <br>
                            <li>
                                Cuando termines, escribe: quit()
                            </li>
                        </ol>
                         
                    </ol>
                </p> 
            </div> 
            <div class="boxa">
                <h5>Dos bases de datos con una tabla cada una</h5>
        <pre><code class="html">
        from flask import Flask
        from flask_sqlalchemy import SQLAlchemy
        
        application = Flask(__name__) 
        
        application.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///user.db'
        application.config['SQLALCHEMY_BINDS'] = 
        {'sentence': 'sqlite:///sentence.db'}
        db = SQLAlchemy(application)
        
        class User(db.Model):
            __tablename__ = "user_table"
            id = db.Column(db.Integer, primary_key=True)
            username = db.Column(db.String(30), unique=True, nullable=False)
            sentence = db.relationship('Sentence', backref='author', lazy=True)
        
        class Sentence(db.Model):
            __bind_key__ = 'sentence'
            __tablename__ = 'sentence_table'
            id = db.Column(db.Integer, primary_key=True)
            incorrect_sentence = db.Column(db.String)
            user_id = db.Column(db.Integer, 
            db.ForeignKey('user_table.id'), nullable=False)
            
        @application.route('/')
        @application.route('/home')
        def home():
            return "&#60;h1&#62;Bienvenido a casa&#60;/h1&#62;"
        
        if __name__=='__main__':
            application.run(debug=True) 
        </code></pre>                
            </div> 
        </div>
        
            
    </section>
    


    <!-- Section 2 -->
    <section class="section_2" id="section2">
        <div class="container" style="display:block;">
            <h1>Bases de datos, aplicadas</h1>
            <h4>Algunos enlaces útiles</h4>
            <p>
                Los enlaces al video de YouTube y la cuenta de GitHub para esta sección están a continuación:
            </p>
            <div class="section_container_buttons_chapters">
                <a class="btn-section2" href="#" target="_blank">YouTube (Sección 2a)</a>
                <a class="btn-section2" href="#" target="_blank">YouTube (Sección 2b)</a>
                <a class="btn-section2" href="#" target="_blank">GitHub (Boilerplate 2a)</a>
                <a class="btn-section2" href="#" target="_blank">GitHub (Final 2a)</a>
                <a class="btn-section2" href="#" target="_blank">GitHub (Boilerplate 2b)</a>
                <a class="btn-section2" href="#" target="_blank">GitHub (Final 2b)</a>
            </div>
        </div>
    
        <div class="container">
            <div class="boxa" style="text-align: left; margin:0px; padding:0px;">
                <h4>Crear las bases de datos</h4>
                <div class="section_container_buttons_chapters">
                    <a class="btn-section2" href="#" target="_blank">YouTube (Sección 2a)</a>
                    <a class="btn-section2" href="#" target="_blank">GitHub (Boilerplate 2a)</a>
                    <a class="btn-section2" href="#" target="_blank">GitHub (Final 2a)</a>
                </div>
                <p style="text-align: left;">
                    En esta sección, creamos dos bases de datos en nuestra aplicación, cada una con una tabla. Procedemos en cuatro pasos diferentes.
                    <ol>
                        <li>
                            En el archivo <strong>__init__.py</strong>:
                            <ol type="a">
                                <li>
                                    Importamos SQLAlchemy:
                                    <pre><code class="html"></code>
    from flask_sqlalchemy import SQLAlchemy
                                    </code></pre>
                                </li>
                                <li>
                                    Definimos una ubicación para nuestra base de datos, creamos los enlaces y definimos la base de datos:
                                    <pre><code class="html"></code>
    application.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///user.db'
    application.config['SQLALCHEMY_BINDS'] ={'sentence': 'sqlite:///sentence.db'}
    db = SQLAlchemy(application)
                                    </code></pre>
                                </li>
                            </ol>
                        </li>
                        <li>
                            En el archivo <strong>models.py</strong>, debemos definir nuestras tablas (el código para la aplicación está en el panel derecho):
                        </li>
                        <br>
                        <li>
                            En las <strong>rutas</strong>, debemos introducir algunos cambios para crear las tablas cuando creamos las bases de datos. Esto se debe a que estamos trabajando con blueprints, y si no importamos las tablas a nuestros paquetes de blueprint y definimos esas tablas allí, cuando creemos la base de datos, estará vacía, ya que no hemos definido las tablas.
                            <ol type="a">
                                <li>
                                    En el <strong>paquete home</strong>, y en el archivo routes.py, debemos escribir:
                                    <pre><code class="html"></code>
    from capp.models import User
                                   </code></pre>
                                </li>
                                <li>
                                    En el <strong>paquete light_talk_app</strong>, y en el archivo routes.py, debemos escribir:
                                    <pre><code class="html"></code>
    from capp.models import Sentence
                                    </code></pre>
                                </li>
                            </ol>
                        </li>
                        <li>
                            Después de introducir los tres pasos anteriores, <strong>creamos nuestra base de datos</strong>. Debemos proceder en tres pasos. Consulta la sección anterior, ya que los pasos son exactamente los mismos.
                        </li>
                    </ol>
                </p>
            </div>
            <div class="boxa" style="height:660px;">
                <h5>models.py</h5>
    <pre><code class="html">
    from capp import db
    from datetime import datetime
    
    # Base de datos Usuario
    class User(db.Model):
        __tablename__ = "user_table"
        id = db.Column(db.Integer, primary_key=True)
        username = db.Column(db.String(30), unique=True, nullable=False)
        email = db.Column(db.String(120), unique=True, nullable=False)
        password = db.Column(db.String(60), nullable=False)
        sentence = db.relationship('Sentence', backref='author', //
        lazy=True)
    
    # Base de datos Sentencee
    class Sentence(db.Model):
        __bind_key__ = 'sentence'
        __tablename__= 'sentence_table'
        id = db.Column(db.Integer, primary_key=True)
        incorrect_sentence = db.Column(db.String)
        correct_sentence_one = db.Column(db.String)
        correct_sentence_two = db.Column(db.String)
        correct_sentence_three = db.Column(db.String)
        correct_sentence_four = db.Column(db.String)
        objective = db.Column(db.String)
        source = db.Column(db.String)
        user_id = db.Column(db.Integer, db.ForeignKey('user_table.id'),//
        nullable=False)
    </code></pre>
            </div>
        </div>
    
        <div class="container">
            <div class="boxa" style="text-align: left; margin:0px; padding:0px;">
                <h4>Agregar usuarios a nuestra base de datos y crear contraseñas seguras</h4>
                <div class="section_container_buttons_chapters">
                    <a class="btn-section2" href="#" target="_blank">YouTube (Sección 2b)</a>
                    <a class="btn-section2" href="#" target="_blank">GitHub (Boilerplate 2b)</a>
                    <a class="btn-section2" href="#" target="_blank">GitHub (Final 2b)</a>
                </div>
                <p style="text-align: left;">
                    En el <strong>paquete user</strong>, en el archivo routes.py, debemos introducir tres cambios (el código para la aplicación está en el panel derecho):
                    <ol>
                        <li>
                            <strong>Importamos los paquetes</strong> que necesitamos:
                            <pre><code class="html"></code>
    from capp import db, bcrypt
                            </code></pre>
                        </li>
                        <li>
                            <strong>Aseguramos</strong> la contraseña:
                            <pre><code class="html"></code>
    user_hashed_password = bcrypt.generate_password_hash//
    (form.password.data).decode('utf-8')
                            </code></pre>
                        </li>
                        <li>
                            <strong>Agregamos el usuario</strong> creado en el formulario a nuestra base de datos:
                            <pre><code class="html"></code>
    user = User(username=form.username.data, //
    email=form.email.data, password=user_hashed_password)
    db.session.add(user)
    db.session.commit()
                            </code></pre>
                        </li>
                        <br>
                    </ol>
                </p>
            </div>
            <div class="boxa" style="height:460px;">
                <h5>routes.py</h5>
    <pre><code class="html">
    from capp import db, bcrypt
    
    @users.route('/register', methods=['GET','POST'])
    def register():
        form = RegistrationForm()
        if form.validate_on_submit():
            user_hashed_password = bcrypt.generate_password_hash//
            (form.password.data).decode('utf-8')
            user = User(username=form.username.data, //
            email=form.email.data, password=user_hashed_password)
            db.session.add(user)
            db.session.commit()
            flash('¡Tu cuenta ha sido creada! //
            Ahora puedes iniciar sesión.', 'success')
            return redirect(url_for('home.home_home'))
        return render_template('register.html', title='Register', //
        form=form)
    </code></pre>
            </div>
        </div>

        <div class="container">
            <div class="boxa" style="text-align: left; margin:0px; padding:0px;">
                <h4>Introducción de consultas en nuestra aplicación</h4>
                <div class="section_container_buttons_chapters">
                    <a class="btn-section2" href="#" target="_blank">YouTube (Sección 2b)</a>
                    <a class="btn-section2" href="#" target="_blank">GitHub (Boilerplate 2b)</a>
                    <a class="btn-section2" href="#" target="_blank">GitHub (Final 2b)</a>
                </div>
                <p style="text-align: left;">   
                    Algunos enlaces útiles sobre consultas en SQLAlchemy se pueden encontrar en los siguientes enlaces:
                </p> 
                <div class="section_container_buttons_chapters">
                    <a class="btn-section2" href="https://docs.sqlalchemy.org/en/14/orm/tutorial.html " target="_blank">SQLAlchemy I</a>
                    <a class="btn-section2" href="https://docs.sqlalchemy.org/en/14/core/tutorial.html" target="_blank">SQLAlchemy II</a>
                    <a class="btn-section2" href="https://www.datacamp.com/tutorial/sqlalchemy-tutorial-examples" target="_blank">Radar</a>
                    <a class="btn-section2" href="https://towardsdatascience.com/sqlalchemy-python-tutorial-79a577141a91" target="_blank">Kudari</a>
                </div>   
                <p style="text-align: left;">                    
                    En el <strong>paquete home</strong>, en el archivo routes.py, debemos introducir tres cambios.
                    <ol>
                        <li>
                            <strong>Importamos las tablas</strong> que necesitamos:
                            <pre><code class="html"></code>
        from capp.models import User, Sentence
                            </code></pre>
                        </li>
                        <li>
                            <strong>Crearemos</strong> las consultas:
                            <pre><code class="html"></code>
        user1 = User.query.first().username
        sentence1 = Sentence.query.first().incorrect_sentence
        user3 = User.query.filter_by(username='Bjørk').first().username
        user4 = User.query.filter_by(username='Bjørk').first()
        sentences = Sentence.query.filter_by(user_id=user4.id)
        users = User.query.all()
                            </code></pre>
                        </li>
                        <li>
                            <strong>Pasamos las consultas</strong> a los archivos html:
                            <pre><code class="html"></code>
        return render_template('home.html', user1=user1, //
        sentence1=sentence1, user3=user3, sentences=sentences, users=users)
                            </code></pre>
                        </li>
                    </ol>
                    En la <strong>carpeta de plantillas</strong>, en el archivo home.html necesitamos mostrar las consultas (el código para la aplicación está en el panel derecho):
                </p>      
            </div>
            <div class="boxa" style="height:540px;">
                <h5>home.html</h5>
        <pre><code class="html">
        &#60;!-- Consultas --&#62;
        &#60;section class="section_developers"&#62;
            &#60;div class="container"&#62;
            &#60;div class="developers" style="display:block;"&#62;
                &#60;h5&#62;Consulta 1&#60;/h5&#62;
                &#123;&#123;user1&#125;&#125;
                &#60;h5&#62;Consulta 2&#60;/h5&#62;
                &#123;&#123;sentence1&#125;&#125;
                &#60;h5&#62;Consulta 3&#60;/h5&#62;
                &#123;&#123;user3&#125;&#125;
                &#60;h5&#62;Consulta 4&#60;/h5&#62;
                &#123;% for sentence in sentences %&#125;
                &#123;&#123;sentence.incorrect_sentence&#125;&#125;
                &#123;% endfor %&#125;
                &#60;h5&#62;Consulta 5&#60;/h5&#62;
                &#123;% for user in users %&#125;
                &#123;&#123;user.username&#125;&#125;
                &#123;% endfor %&#125;
            &#60;/div&#62;
            &#60;/div&#62;          
        &#60;/section&#62;
        </code></pre>    
            </div>
        </div>
        
    </section>
    

    <!-- Section 3 -->
    <section class="section_3" id="section3">
        <div class="container" style="display:block;">
            <h1>Personalizar nuestros Validadores de Formularios WTF</h1>
            <h4>Algunos enlaces útiles</h4>
            <p>
                Los enlaces a los videos de YouTube y la cuenta de GitHub para esta sección están a continuación:
            </p>
            <div class="section_container_buttons_chapters">
                <a class="btn-section3" href="#" target="_blank">YouTube (Sección 3)</a>
                <a class="btn-section3" href="#" target="_blank">GitHub (Boilerplate 3)</a>
                <a class="btn-section3" href="#" target="_blank">GitHub (Final 3)</a>
            </div>
            <p>
                Toda la información en esta sección ha sido tomada de los siguientes enlaces:
            </p>
            <div class="section_container_buttons_chapters">
                <a class="btn-section3" href="https://wtforms.readthedocs.io/en/3.0.x/validators/#custom-validators"  target="_blank">Validadores de Formularios Flask</a>
            </div> 
        </div>  
    
        <div class="container">
            <div class="boxa" style="text-align: left; margin:0px; padding:0px;">
                <h4>Personalizar nuestros Validadores de Formularios WTF</h4>
                <p>
                    Personalizamos los mensajes que se muestran al usuario. Si, por ejemplo, intentamos registrarnos usando el mismo nombre de usuario o correo electrónico, recibimos un mensaje no deseado. Para evitar esos mensajes que podrían no ser muy útiles para los usuarios de nuestra aplicación, podemos personalizar nuestros Validadores de Formularios WTF.
                </p> 
                <div class="section_container_buttons_chapters">
                    <a class="btn-section3" href="#" target="_blank">YouTube (Sección 3)</a>
                </div>
                <p class="text-left">
                    En el <strong>paquete users</strong>, en el archivo forms.py.
                    <ol>
                        <li>
                            Copiar y pegar desde el enlace anterior, y luego personalizar.
                            <pre><code class="html"></code>
    class MyForm(Form):
    name = StringField('Nombre', [InputRequired()])
    
    def validate_name(form, field):
        if len(field.data) > 50:
        raise ValidationError('El nombre debe tener menos de 50 caracteres')
                            </code></pre>                             
                        </li>
                        <li>
                            <strong>Importamos</strong> las herramientas que necesitamos:
                            <pre><code class="html"></code>
    from capp.models import User
    from wtforms.validators import ValidationError                                
                            </code></pre> 
                        </li>
                        <li>
                            <strong>Personalizar</strong> errores de nombre de usuario y correo electrónico.
                            <pre><code class="html"></code>
    def validate_username(self, username):
        user = User.query.filter_by(username=username.data).first()
        if user:
            raise ValidationError('Ese nombre de usuario ya está en uso.//
             Por favor, elige uno diferente.')
                                  
    def validate_email(self, email):
        user = User.query.filter_by(email=email.data).first()
        if user:
            raise ValidationError('Ese correo electrónico ya está en uso. //
            Por favor, elige uno diferente.') 
                            </code></pre> 
                        </li>                 
                    </ol>
                </p> 
            </div> 
            <div class="boxa" style="height:660px;">
                <h5>En el paquete users, archivo forms.py</h5>
    <pre><code class="html">
    from flask_wtf import FlaskForm
    from wtforms import StringField, PasswordField, SubmitField, 
        BooleanField
    from wtforms.validators import DataRequired, Length, Email, 
        EqualTo, ValidationError
    from capp.models import User
    
    class RegistrationForm(FlaskForm):
        username = StringField('Nombre de usuario', 
            validators=[DataRequired(), Length(min=2, max=30)])
        email = StringField('Correo electrónico',
            validators=[DataRequired(), Email()])
        password = PasswordField('Contraseña', validators=[DataRequired()])
        confirm_password = PasswordField('Confirmar contraseña',
            validators=[DataRequired(), EqualTo('password')]) 
        submit = SubmitField('Registrarse')
    
        def validate_username(self, username):
        user = User.query.filter_by(username=username.data).first()
        if user:
            raise ValidationError('Ese nombre de usuario ya está en uso. //
            Por favor, elige uno diferente.')
    
        def validate_email(self, email):
        user = User.query.filter_by(email=email.data).first()
        if user:
            raise ValidationError('Ese correo electrónico ya está en uso. //
            Por favor, elige uno diferente.')
    </code></pre>                
            </div> 
        </div> 
    </section>
    
    <!-- Section 4 -->
    <section class="section_4" id="section4">
        <div class="container" style="display:block;">
            <h1>Paquete Flask-login</h1>
            <h4>Algunos enlaces útiles</h4>
            <p>
                Los enlaces al video de YouTube y a la cuenta de GitHub para esta sección están a continuación:
            </p>
            <div class="section_container_buttons_chapters">
                <a class="btn-section4" href="#" target="_blank">YouTube (Sección 4a)</a>
                <a class="btn-section4" href="#" target="_blank">YouTube (Sección 4b)</a>
                <a class="btn-section4" href="#" target="_blank">YouTube (Sección 4c)</a>
                <a class="btn-section4" href="#" target="_blank">GitHub (Boilerplate 4a)</a>
                <a class="btn-section4" href="#" target="_blank">GitHub (Final 4a)</a>
                <a class="btn-section4" href="#" target="_blank">GitHub (Boilerplate 4b)</a>
                <a class="btn-section4" href="#" target="_blank">GitHub (Final 4b)</a>
                <a class="btn-section4" href="#" target="_blank">GitHub (Boilerplate 4c)</a>
                <a class="btn-section4" href="#" target="_blank">GitHub (Final 4c)</a>
            </div> 
            <p>
                Toda la información en esta sección ha sido tomada de los siguientes enlaces:
            </p>
            <div class="section_container_buttons_chapters">
                <a class="btn-section4" href="https://flask-login.readthedocs.io/en/latest/" target="_blank">Flask-login</a>
                <a class="btn-section4" href="https://www.youtube.com/watch?v=CSHx6eCkmv0&list=PL-osiE80TeTs4UjLw5MM6OjgkjFeUxCYH&index=6" target="_blank">Corey</a>
            </div>
            <h4>¿Qué es Flask-login?</h4>
            <p>
                Flask-Login proporciona la gestión de sesiones de usuario para Flask. Maneja las tareas comunes de iniciar sesión, cerrar sesión y recordar las sesiones de tus usuarios durante períodos prolongados.
                <br>
                <br>
                Este paquete hará lo siguiente:
                <ul>
                    <li>
                        Almacenar la ID del usuario activo en la Sesión de Flask, y permitirte iniciar y cerrar sesión fácilmente.
                    </li>
                    <li>
                        Permitirte restringir vistas a usuarios que hayan iniciado sesión (o no hayan iniciado sesión) (login_required).
                    </li>
                    <li>
                        Manejar la funcionalidad de “recordarme”, que normalmente es complicada.
                    </li>
                    <li>
                        Ayudar a proteger las sesiones de tus usuarios contra el robo de cookies.
                    </li>
                </ul>                
            </p>
            <h4>¿Cómo usar Flask-login?</h4>
            <ol>
                <li>
                    <strong>Instalación</strong>
                    <br>
                    <br>
                    Instala la extensión con pip: pip install flask-login.
                </li>
                <br>
                <li>
                    <strong>Configurando tu aplicación</strong>
                    <br>
                    <br>
                    La parte más importante de una aplicación que usa Flask-Login es la clase LoginManager. Deberías crear una para tu aplicación en algún lugar de tu código, así:
                    <pre><code class="html"></code>
from flask_login import LoginManager
login_manager = LoginManager()
                    </code></pre> 
                    El login manager contiene el código que permite que tu aplicación y Flask-Login trabajen juntos, como cargar un usuario a partir de un ID, a dónde enviar a los usuarios cuando necesitan iniciar sesión, y similares.
                </li>
                <br>
                <li>
                    <strong>Cómo funciona</strong>
                    <br>
                    <br>
                    Necesitarás proporcionar un callback user_loader. Este callback se utiliza para recargar el objeto usuario a partir de la ID del usuario almacenada en la sesión. Debe tomar la ID del usuario como cadena de texto y devolver el objeto de usuario correspondiente. Por ejemplo:
                    <pre><code class="html"></code>
@login_manager.user_loader
def load_user(user_id):
    return User.get(user_id)
                    </code></pre> 
                    Debe devolver None (no generar una excepción) si la ID no es válida. (En ese caso, la ID se eliminará manualmente de la sesión y se continuará con el procesamiento).
                </li>
                <br>
                <li>
                    <strong>Tu clase de usuario</strong>
                    <br>
                    <br>
                    La clase que utilizas para representar a los usuarios necesita implementar estas propiedades y métodos:
                    <br>
                    <ol type="a">
                        <li>
                            <strong>is_authenticated</strong>
                            <br>
                            <br>
                            Esta propiedad debe devolver True si el usuario está autenticado, es decir, ha proporcionado credenciales válidas. (Solo los usuarios autenticados cumplirán los criterios de login_required).
                        </li>
                        <br>
                        <li>
                            Hay <strong>otras clases</strong> que no vamos a utilizar, pero que se pueden estudiar en el enlace de Flask-login que proporcioné arriba en esta sección.
                        </li>
                    </ol>
                </li>
                <br>
                <li>
                    <strong>Documentación de la API</strong>
                    <br>
                    <br>
                    Esta documentación se genera automáticamente a partir del código fuente de Flask-Login.
                    <br>
                    <ol type="a">
                        <li>
                            <strong>flask_login.current_user</strong>
                            <br>
                            <br>
                            Un proxy para el usuario actual.
                        </li>
                        <br>
                        <li>
                            <strong>flask_login.login_user(user, remember=False, duration=None, force=False, fresh=True)</strong>
                            <br>
                            <br>
                            Inicia sesión con un usuario. Debes pasar el objeto usuario real a esto. Si la propiedad is_active del usuario es False, no se iniciará sesión a menos que force sea True.
                            <br>
                            <br>
                            Esto devolverá True si el intento de inicio de sesión tiene éxito, y False si falla (es decir, porque el usuario está inactivo).
                            <br>
                            <br>
                            <u>Parámetros:</u>
                            <ul>
                                <li>
                                    user (objeto) - El objeto usuario para iniciar sesión.
                                </li>
                                <li>
                                    remember (bool) - Si se debe recordar al usuario después de que expire su sesión. Por defecto es False.
                                </li>
                                <li>
                                    duration (datetime.timedelta) - La cantidad de tiempo antes de que expire la cookie de recordatorio. Si es None, se usa el valor establecido en la configuración. Por defecto es None.
                                </li>
                                <li>
                                    force (bool) - Si el usuario está inactivo, configurar esto como True permitirá iniciar sesión de todos modos. Por defecto es False.
                                </li>
                                <li>
                                    fresh (bool) - Configurar esto como False iniciará sesión con una sesión marcada como no “fresca”. Por defecto es True.
                                </li>
                            </ul>
                        </li>
                        <br>
                        <li>
                            <strong>flask_login.logout_user()</strong>
                            <br>
                            <br>
                            Cierra la sesión de un usuario. (No necesitas pasar el usuario real). Esto también limpiará la cookie de recordatorio si existe.
                        </li>                        
                    </ol>
                </li>
                <br>
                <li>
                    <strong>Ayudantes del objeto usuario</strong>
                    <br>
                    <br>
                    <strong>class flask_login.UserMixin</strong>
                    <br>
                    <br>
                    Esto proporciona implementaciones predeterminadas para los métodos que Flask-Login espera que tengan los objetos usuario.
                </li>
            </ol>
        </div>
    
        <div class="container">
            <div class="boxa" style="text-align: left; margin:0px; padding:0px;">
                <h4>Flask-login en nuestra aplicación.</h4>
                <div class="section_container_buttons_chapters">
                    <a class="btn-section4" href="#" target="_blank">YouTube (Sección 4a)</a>
                    <a class="btn-section4" href="#" target="_blank">GitHub (Boilerplate 4a)</a>
                    <a class="btn-section4" href="#" target="_blank">GitHub (Final 4a)</a>
                </div> 
                <p style="text-align: left;">                    
                    En esta sección, utilizamos Flask-login en nuestra aplicación. Introducimos cuatro cambios que nos permiten usar diferentes funcionalidades de Flask-login.
                    <ol>
                        <li>
                            <strong>Instalación</strong>: 
                            <pre><code class="html"></code>
        pip install flask-login
                            </code></pre>
                        </li>
                        <li>
                            <strong>Configuración</strong>. En el archivo __init__.py:
                            <ol type="a">
                                <li>
                                    Importa las herramientas que necesitamos:
                                    <pre><code class="html"></code>
        from flask_login import LoginManager
        login_manager.login_view = 'users.login'
        login_manager.login_message_category = 'info'
                                    </code></pre> 
                                </li>
                                <li>
                                    Configura la aplicación:
                                    <pre><code class="html"></code>
        login_manager= LoginManager(application)
                                    </code></pre> 
                                </li>
                            </ol>
                        </li> 
                        <br>
                        <li>
                            <strong>Cómo funciona</strong>. En el archivo models.py:
                            <ol type="a">
                                <li>
                                    Importa las herramientas que necesitamos:
                                    <pre><code class="html"></code>
        from capp import login_manager
                                    </code></pre> 
                                </li>
                                <li>
                                    Importa UserMixin: 
                                    <pre><code class="html"></code>
        from flask_login import UserMixin
                                    </code></pre>                                    
                                </li>
                                <li>
                                    Define la función:
                                    <pre><code class="html"></code>
        @login_manager.user_loader
        def load_user(user_id):
            return User.query.get(int(user_id)) 
                                    </code></pre> 
                                </li>
                                <li>
                                    Úsalo en las Clases: 
                                    <pre><code class="html"></code>
        class User(db.Model, UserMixin)
                                    </code></pre> 
                                </li>
                            </ol>
                        </li>                 
                    </ol>
                </p>      
            </div>
            <div class="boxa" style="height:930px;">
                <h5>En el archivo __init__.py:</h5>
        <pre><code class="html">
        from flask_login import LoginManager
        
        login_manager= LoginManager(application)
        login_manager.login_view = 'users.login'
        login_manager.login_message_category = 'info'
        </code></pre>   
        <h5>En el archivo models.py:</h5>
        <pre><code class="html">
        from capp import login_manager
        from flask_login import UserMixin
        
        @login_manager.user_loader
        def load_user(user_id):
            return User.query.get(int(user_id))
        </code></pre> 
                <h5>En el paquete users, en el archivo routes.py:</h5>
        <pre><code class="html">
        from capp.users.forms import RegistrationForm
        from capp.models import User
        from capp import db, bcrypt
        from flask_login import login_user
        
        users=Blueprint('users',__name__)
        
        @users.route('/register', methods=['GET','POST'])
        def register():
            form = RegistrationForm()
            if form.validate_on_submit():
                user_hashed_password = //
                bcrypt.generate_password_hash(form.password.data).decode('utf-8')
                user = User(username=form.username.data, email=form.email.data, //
                password=user_hashed_password)
                db.session.add(user)
                db.session.commit()
                flash('¡Tu cuenta ha sido creada! Ahora puedes iniciar sesión.', 'success')
                return redirect(url_for('users.login'))
            return render_template('users/register.html', //
            title='register', form=form)
        </code></pre>  
        
            </div>
        </div>


        <div class="container" style="display:block;">
            <p style="text-align: left;">                    
                <ol start="4">
                    <li>
                        En el <strong>paquete users</strong>, archivo routes.py, ruta de inicio de sesión:
                        <ol type="a">
                            <li>
                                Importa las herramientas que necesitamos:
                                <pre><code class="html"></code>
        from flask_login import login_user
                                </code></pre> 
                            </li>
                            <li>
                                Modifica la ruta:
                                <pre><code class="html"></code>
        user = User.query.filter_by(email=form.email.data).first()
        if user and bcrypt.check_password_hash(user.password, form.password.data):
            login_user(user, remember=form.remember.data)
            flash('¡Has iniciado sesión! Ahora puedes comenzar a usar nuestra aplicación.', 'success')
        else:
            flash('Inicio de sesión fallido. ¡Por favor, verifica el correo electrónico y la contraseña!', 'danger')
                                </code></pre> 
                            </li>
                            <li>
                                Verifica el campo:
                                <pre><code class="html"></code>
        login_user(user, remember=form.remember.data)
                                </code></pre>
                            </li>
                        </ol>
                    </li>
                </ol>
            </p> 
        </div>

        <div class="container">
            <div class="boxa" style="text-align: left; margin:0px; padding:0px;">
                <h4>Usuario autenticado, cerrar sesión y redirigir a la última página visitada</h4>
                <div class="section_container_buttons_chapters">
                    <a class="btn-section4" href="#" target="_blank">YouTube (Sección 4b)</a>
                    <a class="btn-section4" href="#" target="_blank">GitHub (Boilerplate 4b)</a>
                    <a class="btn-section4" href="#" target="_blank">GitHub (Final 4b)</a>
                </div> 
                <p style="text-align: left;">                    
                    En esta sección, nos enfocamos en tres usos diferentes de Flask-login que son útiles para nuestra aplicación. 
                    <ol>
                        <li>
                            Si el usuario está autenticado, no queremos que inicie sesión nuevamente en nuestra aplicación, sino que lo redirigimos a la página principal. Para hacer esto, en el <strong>paquete users</strong>, en el <strong>archivo routes.py</strong>, procedemos en dos pasos: 
                            <ol type="a">
                                <li>
                                    Importamos las herramientas que necesitamos: 
                                    <pre><code class="html"></code>
        from flask_login import current_user
                                    </code></pre> 
                                </li>
                                <li>
                                    En la ruta de inicio de sesión, necesitamos redirigir al usuario a la página principal:
                                    <pre><code class="html"></code>
        if current_user.is_authenticated:
            return redirect(url_for('home.home_home'))
                                    </code></pre> 
                                </li>
                            </ol>
                        </li>
                        <li>
                            Queremos permitir que el usuario cierre sesión. Para hacer esto, en el <strong>paquete users</strong>, en el <strong>archivo routes.py</strong>, procedemos en dos pasos:
                            <ol type="a">
                                <li>
                                    Importamos las herramientas que necesitamos: 
                                    <pre><code class="html"></code>
        from flask_login import logout_user
                                    </code></pre> 
                                </li>
                                <li>
                                    Necesitamos crear una nueva ruta:
                                    <pre><code class="html"></code>
        @users.route('/logout')
        def logout():
            logout_user()
            return redirect(url_for('home.home_home')) 
                                    </code></pre> 
                                </li>
                            </ol>
                        </li> 
                        <br>
                        <li>
                            Dado que la aplicación light_talk está conectada a una base de datos para registrar las frases, no queremos permitir que el usuario acceda a esa página web hasta que haya iniciado sesión. Para hacer esto, en el <strong>paquete light_talk_app</strong>, en el <strong>archivo routes.py</strong>, procedemos en dos pasos:
                            <ol type="a">
                                <li>
                                    Importamos las herramientas que necesitamos:
                                    <pre><code class="html"></code>
        from flask_login import login_required
                                    </code></pre> 
                                </li>
                                <li>
                                    Introducimos un nuevo decorador en las rutas que queremos modificar:
                                    <pre><code class="html"></code>
        @light_talk_app.route('/light_talk_app')
        @login_required
                                    </code></pre>                                    
                                </li>
                            </ol>
                        </li>                
                    </ol>
                </p>      
            </div>
            <div class="boxa" style="height:1200px;">
                <h5>En el paquete user, archivo routes.py:</h5>
        <pre><code class="html">
        from flask import render_template, Blueprint, redirect, flash,
            url_for, request
        from capp.users.forms import RegistrationForm, LoginForm
        from capp.models import User
        from capp import db, bcrypt
        from flask_login import login_user, current_user, logout_user 
        
        users=Blueprint('users',__name__)
        
        @users.route('/register', methods=['GET','POST'])
        def register():
          ...
        
        @users.route('/login', methods=['GET','POST'])
        def login():
          form = LoginForm()
          if current_user.is_authenticated:
                return redirect(url_for('home.home_home'))
          if form.validate_on_submit():
            user = User.query.filter_by(email=form.email.data).first()
            if user and bcrypt.check_password_hash(user.password, 
                form.password.data):
                login_user(user, remember=form.remember.data)
                next_page = request.args.get('next')
                flash('¡Has iniciado sesión! Ahora puedes comenzar a 
                usar nuestra aplicación Light Talk.', 'success')
                return redirect(next_page) if next_page else 
                  redirect(url_for('home.home_home'))
            else:
                flash('Inicio de sesión fallido. ¡Por favor, 
                verifica el correo electrónico y la contraseña!', 
                  'danger') 
          return render_template('users/login.html', title='login', form=form)
        
        @users.route('/logout')
        def logout():    
            logout_user()
            return redirect(url_for('home.home_home'))
        </code></pre>  
                <h5>En el paquete light_talk_app, archivo routes.py:</h5>
        <pre><code class="html">
        @light_talk_app.route('/light_talk_app')
        @login_required
        
        @light_talk_app.route('/light_talk_app/nueva_frase')
        @login_required
        
        @light_talk_app.route('/light_talk_app/tus_frases')
        @login_required    
        </code></pre> 
        
            </div>
        </div>
        
        <div class="container" style="display:block;">
            <p style="text-align: left;">                    
                <ol start="4">
                    <li>
                        Si el usuario intenta acceder a las rutas que queremos proteger obligando al usuario a estar autenticado, el usuario será redirigido a la página de inicio de sesión. En ese caso, después de iniciar sesión, queremos que el usuario sea redirigido a la última página a la que intentó acceder. Para hacer esto, en el <strong>paquete users</strong>, en el <strong>archivo routes.py</strong>, procedemos en dos pasos: 
                        <ol type="a">
                            <li>
                                Importamos las herramientas que necesitamos:
                                <pre><code class="html"></code>
        from flask import request
                                </code></pre> 
                            </li>
                            <li>
                                Modificamos la ruta de inicio de sesión:
                                <pre><code class="html"></code>
        if user and bcrypt.check_password_hash(user.password, form.password.data):
            login_user(user, remember=form.remember.data)
            next_page = request.args.get('next')
            flash('¡Has iniciado sesión! Ahora puedes comenzar a usar nuestra aplicación Light Talk.', 'success')
            return redirect(next_page) if next_page else redirect(url_for('home.home_home'))
        else:
                                </code></pre> 
                            </li>
                        </ol>
                    </li>
                </ol>
            </p> 
        </div>

        <div class="container">
            <div class="box_two">
                <h5>Cambios en la barra de navegación (archivo layout.html):</h5>
                <pre><code class="html">
        &#123;% if current_user.is_authenticated %&#125;
        &#60;nav&#62;
            &#60;ul&#62;
                &#60;li&#62;
                &#60;a href="&#123;&#123;url_for('users.logout')&#125;&#125;"&#62;Cerrar sesión&#60;/a&#62;
                &#60;/li&#62;
                &#60;li&#62;
                    &#60;a href="&#123;&#123;url_for('home.home_home')&#125;&#125;"&#62;Inicio&#60;/a&#62;
                &#60;/li&#62;
                &#60;li&#62;
                    &#60;a href="&#123;&#123;url_for('business.business_home')&#125;&#125;"&#62;
                    Negocio&#60;/a&#62;
                &#60;/li&#62;
                &#60;li&#62;
                    &#60;a href="&#123;&#123;url_for('light_talk_app.light_talk_app_home')&#125;&#125;"&#62;
                    Light-Talk-App&#60;/a&#62;
                &#60;/li&#62;
            &#60;/ul&#62;
        &#60;/nav&#62; 
        &#123;% else %&#125;
        &#60;nav&#62;
            &#60;ul&#62;
                &#60;li&#62;
                &#60;a href="&#123;&#123;url_for('users.register')&#125;&#125;"&#62;Registrarse&#60;/a&#62;
                &#60;/li&#62;
                &#60;li&#62;
                &#60;a href="&#123;&#123;url_for('users.login')&#125;&#125;"&#62;Iniciar sesión&#60;/a&#62;
                &#60;/li&#62;
                &#60;li&#62;
                    &#60;a href="&#123;&#123;url_for('home.home_home')&#125;&#125;"&#62;Inicio&#60;/a&#62;
                &#60;/li&#62;
                &#60;li&#62;
                    &#60;a href="&#123;&#123;url_for('business.business_home')&#125;&#125;"&#62;
                    Negocio&#60;/a&#62;
                &#60;/li&#62;
                &#60;li&#62;
                    &#60;a href="&#123;&#123;url_for('light_talk_app.light_talk_app_home')&#125;&#125;"&#62;
                    Light-Talk-App&#60;/a&#62;
                &#60;/li&#62;
            &#60;/ul&#62;
        &#60;/nav&#62;
        &#123;% endif %&#125;
                </code></pre>
            </div>
            <div class="box_two" style="height:410px;">
                <h5>Cambios en la página de inicio (archivo home.html):</h5>
                <pre><code class="html">
        &#123;% if current_user.is_authenticated %&#125;
        &#123;% else %&#125;
        &#60;div class="container_buttons_links_header_home"&#62;&#123;
            &#60;div class="btn"&#62;
                &#60;a href="&#123;&#123;url_for('users.register')&#125;&#125;" 
                class="btn btn-primary btn-lg mr-2", 
                style="background-color:#007bff;"&#62;Registrarse&#60;/a&#62;
            &#60;/div&#62;
            &#60;div class="btn"&#62;
                &#60;a href="&#123;&#123;url_for('users.login')&#125;&#125;" 
                class="btn btn-primary btn-lg mr-2", 
                style="background-color:#007bff;"&#62;Iniciar sesión&#60;/a&#62;
            &#60;/div&#62;
        &#60;/div&#62;
        &#123;% endif %&#125;
                </code></pre>
            </div>
        </div>
    </section>

    <!-- Section 5 -->
    <section class="section_1" id="section5">

        <div class="container">
            <div class="box_three">                    
            </div>
            <div class="box_three">
                <div class="h1 mb-3" style="text-align: center;">
                    <i class="bi bi-calendar"></i>
                </div>
                <h1>Reto Semanal</h1>
                <p style="text-align: left;"> 
                    En este reto semanal, vamos a crear algunas <strong>consultas SQLAlchemy</strong> para acceder a nuestras bases de datos, y vamos a utilizar <strong>código Python</strong> para extraer información de las filas obtenidas mediante las consultas.
                    <br>
                    <br>
                    Nos vamos a enfocar en cinco consultas diferentes. Sin embargo, te animo a que crees tus propias consultas y experimentes con las bases de datos y el código Python. Las seis consultas que vamos a estudiar en el reto semanal son:
                    <ol style="text-align: left;">
                        <li>
                            Consulta 1: Frases por usuario.
                        </li>
                        <li>
                            Consulta 2: Frases incorrectas por usuario.
                        </li>
                        <li>
                            Consulta 3: Frases correctas por usuario.
                        </li>
                        <li>
                            Consulta 4: Objetivos por usuario. 
                        </li>
                        <li>
                            Consulta 5: Fuente por usuario. 
                        </li>
                    </ol>
                </p> 
                <p style="text-align: left;">    
                    Sé que este reto semanal puede ser difícil, ya que vas a utilizar consultas SQLAlchemy y Python, y algunos de ustedes no están familiarizados con estos dos lenguajes de programación. Te animo a revisar el código, ejecutar la aplicación y tratar de entender la lógica detrás del código. Vamos a revisar el reto semanal juntos durante las clases.
                </p>  
                <div class="container_buttons_links_section_3a">
                    <div class="btn">
                        <a href="#" class="btn btn-primary btn-lg mr-2" style="background-color:#007bff;" data-toggle="modal" data-target="#weekly_challenge_ch3_week1">Pistas</a>
                    </div>
                    <div class="btn">
                        <a href="#" target="_blank" class="btn btn-primary btn-lg mr-2" style="background-color:#007bff;">GitHub (Boilerplate)</a>
                    </div> 
                    <div class="btn">
                        <a href="#" target="_blank" class="btn btn-primary btn-lg mr-2" style="background-color:#007bff;">GitHub (Final)</a>
                    </div>                 
                    <!-- Modal Instructions1 -->
                    <div class="modal fade" id="weekly_challenge_ch3_week1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
        
                                <div class="modal-header">
                                    <h5 class="modal-title" style="color:black">Reto Semanal, capítulo 4</h5>
                                </div>
        
                                <div class="modal-body" style="color:black">
                                    <p style="text-align: left;">
                                        En la cuenta de GitHub, tienes el código para el reto semanal.
                                        <ol style="text-align: left;">
                                            <li>
                                                Instala los paquetes en el archivo requirements.txt.
                                            </li>
                                            <br>
                                            <li>
                                                Crea las bases de datos y puebla utilizando el archivo create_data.py.
                                            </li>
                                            <br>
                                            <li>
                                                Ve al archivo routes.py en el paquete home y escribe el código para las consultas.
                                            </li>
                                            <br>
                                            <li>
                                                Ve al archivo home.html y escribe el código para mostrar las consultas.
                                            </li>
                                        </ol>
                                    </p>
                                </div>
        
                                <div class="modal-footer">
                                    <a href="{{ url_for('es_course_chats.es_course_chats_create_chat') }}" class="btn btn-primary btn-lg mr-2" style="background-color:#007bff;">Chat Principal</a>
                                    <button class="btn btn-secondary btn-lg mr-2" style="background-color:#6c757d;" data-dismiss="modal">Cerrar</button>
                                </div>
        
                            </div>
                        </div>
                    </div>
                </div>
            </div>   
            <div class="box_three">                  
            </div> 
        </div>
    
    </section>
    
 


{% endblock content %}
