{% extends "gd_course/HVL_2025_group4/layout.html" %} {% block title %}Your
Data{% endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='/gd_course_HVL_2025_group4/carbon_app/your_data.css') }}"
/>
{% endblock %} {% block content %}

<div class="image-background">
  <img
    src="{{ url_for('static', filename='/gd_course_HVL_2025_group4/images/trainbackground.jpg') }}"
    alt="Background"
    id="bg-image"
  />
  <div class="image-overlay"></div>
</div>

<div class="your-data-container">
  <h1>Your Emission Data</h1>
  <p class="subtitle">
    Here you can see all your submitted transport entries and manage them.
  </p>

  <div class="btn-new-entry">
    <a
      href="{{ url_for('gd_course_HVL_2025_group4.carbon_app_home') }}"
      class="btn-submit"
      >New Entry</a
    >
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %} {% for category, message in messages %}
  <div class="alert alert-{{ category }}">{{ message }}</div>
  {% endfor %} {% endif %} {% endwith %}

  <div class="table-card">
    <table class="table">
      <thead>
        <tr>
          <th>User</th>
          <th>Date</th>
          <th>Kilometres</th>
          <th>Transport</th>
          <th>Fuel</th>
          <th>Days per week</th>
          <th>Kg of CO2 per day</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in entries %}
        <tr>
          <td>{{ current_user.username }}</td>
          <td>{{ entry.date.strftime("%m-%d-%Y") }}</td>
          <td>{{ entry.kms }}</td>
          <td>{{ entry.transport }}</td>
          <td>{{ entry.fuel }}</td>
          <td>{{ entry.total }}</td>
          <td>{{ entry.co2 }}</td>
          <td>
            <a
              href="{{ url_for('gd_course_HVL_2025_group4.delete_emission', entry_id=entry.id) }}"
              class="btn-delete"
              >Delete</a
            >
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="charts-container">
    <div class="chart-box">
      <h3>Emissions per Vehicle</h3>
      <canvas id="pie_transport_chart"></canvas>
    </div>

    <div class="chart-box">
      <h3>Weekly Emissions</h3>
      <canvas id="weekly_emissions_chart"></canvas>
      <p id="weekly-total" style="color: white; margin-top: 10px"></p>
    </div>
  </div>

  <div class="back-link" style="margin-top: 30px">
    <a href="{{ url_for('gd_course_HVL_2025_group4.carbon_app_home') }}">
      <i class="fa-solid fa-arrow-left"></i> Back to Carbon App
    </a>
  </div>
</div>

{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
      const pieLabels = {{ vehicle_labels | tojson }};
      const pieValues = {{ vehicle_totals | tojson }};

      const weeklyLabels = {{ weekly_labels | tojson }};
      const weeklyValues = {{ weekly_emissions | tojson }};

      const pieColors = ['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#8A2BE2','#00FA9A'];

      new Chart(document.getElementById("pie_transport_chart"), {
          type: "pie",
          data: {labels: pieLabels, datasets: [{ label: "Total Emissions", data: pieValues, backgroundColor: pieColors }]},
          options: { plugins: { legend: { labels: { color: '#ffffff'}}}}});

  const weeklyChart = new Chart(document.getElementById("weekly_emissions_chart"), {
      type: "bar",
      data: {
          labels: weeklyLabels,
          datasets: [{
              label: "Weekly CO₂ Emissions (kg)",
              data: weeklyValues,
              backgroundColor: '#36A2EB'
          }]
      },
      options: {plugins: {legend: { labels: { color: '#ffffff' } }},scales: {
              x: { ticks: { color: '#ffffff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
              y: { ticks: { color: '#ffffff', beginAtZero: true }, grid: { color: 'rgba(255,255,255,0.1)' } }}}});

  const totalWeeklyEmission = weeklyValues.reduce((a,b) => a+b, 0);
  document.getElementById("weekly-total").textContent = `Your total weekly emissions are ${totalWeeklyEmission.toFixed(2)} kg CO₂`;
</script>

{% endblock %} {% endblock %}
